<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>axiosçš„å¸¸è§ä½¿ç”¨æ–¹å¼</title>
    <style>
        li {
            list-style: none;
            width: 100%;
        }
        .content-box {
            /* background-color: skyblue; */
        }
    </style>
</head>
<body>
    <h1>axios çš„å¸¸è§è¯·æ±‚ä½¿ç”¨æ–¹å¼</h1>
    <div class="content-box">
        formData: ä¸Šä¼ webè¡¨å•æ–‡ä»¶ æ¯”å¦‚å›¾ç‰‡æˆ–è€…é™„ä»¶
        application/json: ä¸Šä¼ jsonå¯¹è±¡
    </div>
    <ul>
        <li>
            <h3>1.GET è·å–æ•°æ® ç”¨åœ¨æŸ¥è¯¢åˆ—è¡¨çš„æ—¶å€™ç”¨åˆ°</h3>
            <h2>get æ–¹æ³•çš„é…ç½® axios.get(url[,config])</h2>
            <div class="content-box">
                get æ–¹å¼è¯·æ±‚ä½¿ç”¨ params å‚æ•°ä¼ é€’ params å¿…é¡»æ˜¯ä¸€ä¸ªæ— æ ¼å¼å¯¹è±¡ï¼ˆplain objectï¼‰æˆ–
                URLSearchParams å¯¹è±¡ paramsa å¿…é¡»æ˜¯é”®å€¼å¯¹æ–¹å¼ä¼ é€’ å¦åˆ™ axios ä¼šè‡ªåŠ¨å¸®ä½ å¤„ç†ä¸º 0=å‚æ•°çš„å½¢å¼
                å‚æ•°ï¼šurlåæ‹¼æ¥å‚æ•° è¯·æ±‚ä½“ï¼ˆrequest bodyï¼‰ä¼ å‚ï¼ˆparams:......ï¼‰
            </div>
        </li>
        <li>
            <h3>2.POST æäº¤æ•°æ® è¡¨å•æäº¤ã€æ–‡ä»¶ä¸Šä¼ </h3>
            <h2>post æ–¹æ³•çš„é…ç½® axios.post(url[,data[,config]])</h2>
            <div class="content-box">
                å‚æ•°ï¼šurlæ‹¼æ¥å’Œè¯·æ±‚ä½“ä¼ å‚ï¼ˆdata:......ï¼‰
                è¯·æ±‚æ–¹å¼ï¼šformDataå’Œapplication/json
            </div>
        </li>
        <li>
            <h3>3.PUT æ›´æ–°æ•°æ® æ‰€æœ‰æ•°æ®æ¨é€åˆ°åç«¯</h3>
            <h2>put æ–¹æ³•çš„é…ç½® axios.put(url[,data[,config]])</h2>
            <div class="content-box">
                å‚æ•°ï¼šurlæ‹¼æ¥å’Œè¯·æ±‚ä½“ä¼ å‚ï¼ˆdata:......ï¼‰
                è¯·æ±‚æ–¹å¼ï¼šformDataå’Œapplication/json
            </div>
        </li>
        <li>
            <h3>4.DELETE åˆ é™¤æ•°æ® æ ¹æ®IDåˆ é™¤æŸåˆ—æ•°æ®</h3>
            <h2>delete æ–¹æ³•çš„é…ç½® axios.delete(url[,config])</h2>
            <div class="content-box">
                å‚æ•°ï¼šurlæ‹¼æ¥å’Œè¯·æ±‚ä½“ä¼ å‚ï¼ˆdata:......ï¼‰
                è¯·æ±‚æ–¹å¼ï¼šformDataå’Œapplication/json
            </div>
        </li>
        <li>
            <h3>5.ä¸ºæ–¹ä¾¿èµ·è§ ä¸ºæ‰€æœ‰æ”¯æŒçš„è¯·æ±‚æ–¹æ³•æä¾›äº†åˆ«å</h3>
            <h2>delete æ–¹æ³•çš„é…ç½® axios.delete(url[,config])</h2>
            <div class="content-box">
                å‚æ•°ï¼šurlæ‹¼æ¥å’Œè¯·æ±‚ä½“ä¼ å‚ï¼ˆdata:......ï¼‰
            </div>
        </li>
    </ul>
    <div class="content-box">
        å¸¸ç”¨æ–¹å¼æ€»ç»“ï¼š
        <p>1.getã€deleteè¯·æ±‚æ–¹å¼ä¸­ ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¯·æ±‚url ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¯·æ±‚çš„ä¸€äº›é…ç½®é¡¹ éœ€è¦ä¼ é€’ç»™åç«¯çš„å‚æ•°åŒ…å«åœ¨é…ç½®é¡¹çš„ data æˆ–è€… params å±æ€§ä¸­</p>
        <p>2.postã€putè¯·æ±‚æ–¹å¼ä¸­ ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿæ˜¯è¯·æ±‚url ç¬¬äºŒä¸ªå‚æ•°ä¸ºå…¥å‚çš„jsonæ•°æ® ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å…¥å‚ä»¥å¤–çš„å…¶å®ƒé…ç½®é¡¹</p>
        <p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.jianshu.com/p/53deecb09077">Axios å„ç§è¯·æ±‚æ–¹å¼ä¼ é€’å‚æ•°æ ¼å¼</a></p>
        <p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.jianshu.com/p/37f91b532a21">axios POSTä¸‰ç§è¯·æ±‚æ–¹å¼</a></p>
    </div>
    <div class="content-box">
        åŸºç¡€æ–¹å¼æ€»ç»“ï¼š
        <h1>Request Config è¯·æ±‚é…ç½® æ˜¯ä¸€ä¸ªå¯¹è±¡ object</h1>
        <ul style="color: red;">
            <li>
                // url æ˜¯ç”¨äºè¯·æ±‚æœåŠ¡å™¨çš„åœ°å€
                url: '/user',
            </li>
            <li>
                // method æ˜¯ç”¨äºè¯·æ±‚æ—¶çš„æ–¹æ³•
                method: 'get', é»˜è®¤
            </li>
            <li>
                // baseURL å°†ä¼šè¢«æ·»åŠ è‡³urlçš„å‰é¢ å¾ˆæ–¹ä¾¿åœ°ä¸ºaxioså®ä¾‹è®¾ç½®ç›¸å¯¹url
                baseUrl: 'https://some-domain.com/api/',
            </li>
            <li>
                // headers æ˜¯è¦å‘é€çš„è‡ªå®šä¹‰çš„è¯·æ±‚å¤´
                headers: {},
            </li>
            <li>
                // params æ˜¯è·Ÿéšè¯·æ±‚ä¸€èµ·å‘é€çš„urlå‚æ•° å¿…é¡»æ˜¯çº¯å¯¹è±¡æˆ–URLSearchParamså¯¹è±¡
                params: {
                    ID: 12345
                },
            </li>
            <li>
                // data æ˜¯è·Ÿéšè¯·æ±‚ä¸€èµ·å‘é€çš„dataè¯·æ±‚å®ä½“ ä»…é€‚ç”¨äº PUTã€POSTã€PATCHæ–¹æ³•
                data: {
                    firstName: 'å¤§çŒª'
                }
            </li>
            <li>
                // timeout è®¾ç½®äº†è¯·æ±‚è¶…æ—¶å‰çš„æ¯«ç§’æ•° milliseconds å¦‚æœè¯·æ±‚çš„æ—¶é—´æ¯”è¿™ä¸ªè®¾ç½®çš„è¶…æ—¶æ—¶é—´è¦é•¿åˆ™è¯·æ±‚å°†ä¼šè¢«ç»ˆæ­¢
                timeout: 15 * 1000,
            </li>
            <li>
                // withCredentials è®¾ç½®çš„æ˜¯æ˜¯å¦å…è®¸è·¨ç«™ç‚¹è¯·æ±‚ è¯·æ±‚æ—¶æ˜¯å¦å¸¦ä¸Šcookieï¼ˆåœ¨ä¸åŒåŸŸåä¸‹åšXHRè¯·æ±‚çš„æ—¶å€™ç”±äºå­˜åœ¨ä¸åŒåŸŸã€åŒ…æ‹¬ åè®® ç«¯å£ åŸŸåã€‘é‚£ä¹ˆcookieã€é»˜è®¤æƒ…å†µã€‘å°†ä¼šæ— æ³•ä¼ é€’ï¼‰
                withCredentials: false, é»˜è®¤
                å‚è€ƒé“¾æ¥ï¼š<a href="http://www.chinacion.cn/article/1216.html">å•ç‚¹ç™»å½•cookieè·¨åŸŸäºŒä¸‰äº‹ä¹‹withCredentials</a>ã€<a href="https://www.cnblogs.com/taohuaya/p/10659834.html">XMLHttpRequest.withCredentials è§£å†³è·¨åŸŸè¯·æ±‚å¤´æ— Cookieçš„é—®é¢˜</a>
            </li>
            <li>
                // proxy å®šä¹‰äº†ä»£ç†æœåŠ¡å™¨çš„ä¸»æœºåå’Œç«¯å£å·
                proxy: {
                    host: '127.0.0.1',
                    port: 9000,
                }
            </li>
        </ul>
        <h1>Response Schema è¯·æ±‚çš„å“åº”åŒ…å«ä»¥ä¸‹ä¿¡æ¯</h1>
        <ul style="color: darkgreen;">
            <li>
                // data æ˜¯æœåŠ¡å™¨æä¾›çš„å“åº”æ•°æ® ä¸€èˆ¬å–çš„å°±æ˜¯è¿™ä¸ª
                data: {},
            </li>
            <li>
                // status æ˜¯æœåŠ¡å™¨è¿”å›çš„httpå“åº”çŠ¶æ€ç 
                status: 200,
            </li>
            <li>
                // statusText æ˜¯æœåŠ¡å™¨è¿”å›çš„httpå“åº”çŠ¶æ€ä¿¡æ¯
                statusText: 'ok',
            </li>
            <li>
                // headers æ˜¯æœåŠ¡å™¨å“åº”çš„æ ‡å¤´ æ˜¯å°å†™çš„ å¯¹åº”çš„åœ¨æµè§ˆå™¨ä¸­çš„ response headers
                headers: {},
            </li>
            <li>
                // config æ˜¯ä¸ºaxiosæä¾›çš„ç”¨äºè¯·æ±‚çš„é…ç½® é‡Œé¢åŒ…å«ä¸€äº›é»˜è®¤é…ç½®
                config: {},
            </li>
            <li>
                // request æ˜¯ç”Ÿæˆæ­¤æ¬¡å“åº”çš„è¯·æ±‚
                request: {},
            </li>
        </ul>
        <h1>Config Defaults ä¸ºæ¯ä¸ªè¯·æ±‚é…ç½®é»˜è®¤å€¼</h1>
        <ul style="color: skyblue;">
            <li>
                // baseURL ç»å¯¹URL åœ¨æ¯ä¸ªè¯·æ±‚å‰éƒ½ä¼šè‡ªåŠ¨æ‹¼æ¥è¿™ä¸ªurl
                baseURL: 'https://api.example.com'
            </li>
            <li>
                // headers æ¯ä¸ªè¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯
                headers: {}
            </li>
        </ul>
        <h1>Interceptors å¯ä»¥ä¸ºæ¯ä¸ªè¯·æ±‚æˆ–å“åº”è®¾ç½®æ‹¦æˆªå™¨ ç„¶åå†è¿›è¡Œå¤„ç†ï¼ˆthenï¼‰æˆ–æ•è·ï¼ˆcatchï¼‰</h1>
        <ul style="color: green;">
            <li>
                æ·»åŠ ä¸€ä¸ªè¯·æ±‚æ‹¦æˆªå™¨
                <pre>
                    axios.interceptors.request.use((config) => {
                            // åœ¨è¯·æ±‚å‘é€ä¹‹å‰åšç‚¹ä»€ä¹ˆ ï¼ˆæ¯”å¦‚ï¼šç»™è¯·æ±‚æ·»åŠ è¯·æ±‚å¤´è®¤è¯ï¼‰
                            return config
                        }, error => {
                            // å¦‚æœè¯·æ±‚å¤±è´¥äº†å¦‚ä½•å¤„ç†
                            return Promise.reject(error)
                        })
                </pre>
            </li>
            <li>
                æ·»åŠ ä¸€ä¸ªå“åº”æ‹¦æˆªå™¨
                <pre>
                    axios.interceptors.response.use((response) => {
                        // åœ¨å“åº”ä¹‹ååšç‚¹ä»€ä¹ˆ ï¼ˆæ¯”å¦‚ï¼šå°è£…promiseå¯¹å“åº”åçš„æ•°æ®æ˜¯å¦æ­£å¸¸è¿”å›æ•°æ®è¿›è¡Œ resolveå¤„ç†æ­£å¸¸å“åº” rejectå¤„ç†å¤±è´¥å“åº” ä»–ä»¬éƒ½ä¼šè¿”å›ä¸€ä¸ªpromiseå®ä¾‹ã€å› ä¸ºresolveæˆ–è€…rejectæ‰§è¡Œæ“ä½œå promiseçš„ä½¿å‘½å°±å®Œæˆäº† åç»­çš„æ“ä½œæ”¾åœ¨.then()é‡Œé¢è€Œä¸æ˜¯ è¿™ä¸¤ä¸ªæ“ä½œå æ‰€ä»¥ä¸€èˆ¬åŠ ä¸Šreturnè¯­å¥ã€‘ï¼‰
                        // ä»»ä½•åœ¨ 2xx èŒƒå›´å†…çš„çŠ¶æ€ç çš„éƒ½ä¼šè§¦å‘æ­¤å“åº”
                        return response
                    }, error => {
                        // å¦‚ä½•è¶…å‡º 2xx èŒƒå›´ä»¥å¤–çš„çŠ¶æ€ç éƒ½ä¼šè§¦å‘æ­¤å“åº”
                        return Promise.reject(error)
                    })
                </pre>
            </li>
        </ul>
        <h1>axios é»˜è®¤æƒ…å†µä¸‹ä¼šå°†jså¯¹è±¡åºåˆ—åŒ–ä¸ºJSON å¦‚æœå¤„ç†æˆ application/x-www-form-urlencoded format è¿™ç§æ ¼å¼</h1>
        <ul>
            <li>
                // åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­
                <pre>
                    const params = new URLSearchParams();
                    params.append('param1', 'value1');
                    params.append('param2', 'value2');
                    axios.post('/foo', params);
                </pre>
                // ä½†æ˜¯ä¸æ˜¯æ‰€æœ‰ï¼›æµè§ˆå™¨æ”¯æŒè¿™ä¸ªAPI ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªqsè¿™ä¸ªåº“
                <pre>
                    const qs = require('qs');
                    axios.post('/foo', qs.stringify({ 'bar': 123 }));
                </pre>
                // åœ¨ES6çš„ç¯å¢ƒä¸­
                <pre>
                    import qs from 'qs';
                    const data = { 'bar': 123 };
                    const options = {
                        method: 'POST',
                        headers: { 'content-type': 'application/x-www-form-urlencoded' },
                        data: qs.stringify(data),
                        url,
                    };
                    axios(options);
                </pre>
            </li>
        </ul>
    </div>


    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        // console.log('ğŸŒˆğŸŒˆğŸŒˆğŸŒˆğŸŒˆğŸŒˆ',axios);

        // 1-1. get ç®€å†™æ¨¡å¼ä¼ å‚
        axios.get('/user?ID=12345&name=å¼ ä¸‰&age=25')
            // ? åé¢æ‹¼æ¥çš„æ˜¯å‚æ•°
            .then(res => {
                // æˆåŠŸä¹‹åçš„å›è°ƒå‡½æ•°
                console.log(res);
            }).catch(err => {
                // å¤±è´¥ä¹‹åçš„å›è°ƒå‡½æ•°
                console.log(err);
            })

        // 1-2. get ä¼ å‚
        axios.get('/user', {
                params: {
                    ID: 12345,
                    name: 'å¼ ä¸‰',
                    age: 25
                }
            })
            .then(res => {
                console.log(res);
            })
            .catch(err => {
                console.log(err);
            })

        // 1-3. async await æ¨¡å¼ä¼ å‚
        async function getUser() {
            try {
                const res = await axios.get('/user?ID=12345&name=zhangsan&age=25')
                console.log(res);
            } catch (e) {
                console.log(e);
            }
        }


        // 2-1. post ç®€å†™æ¨¡å¼ä¼ å‚
        axios.post('/user', {
                firstName: 'å¸…',
                lastName: 'å¤§çŒª'
            })
            .then(res => {
                console.log(res);
            })
            .catch(err => {
                console.log(err);
            })

        // 4-1. ä¼ å‚æ ¼å¼
        // å¦‚æœæœåŠ¡ç«¯å°†å‚æ•°ä½œä¸ºjavaå¯¹è±¡æ¥æ¥æ”¶
        axios.delete('demo/url', {
            data: {
                id: 123,
                name: 'å¤§çŒª',
            }
        })
        // å¦‚æœæœåŠ¡ç«¯å°†å‚æ•°ä½œä¸ºurlå‚æ•°æ¥æ¥æ”¶ åˆ™è¯·æ±‚çš„urlä¸ºï¼šwww.demo/url?id=123&name=å¤§çŒªè¿™ç§æ ¼å¼
        axios.delete('demo/url', {
            params: {
                id: 123,
                name: 'å¤§çŒª',
            }
        })

    </script>

    <script>
        // let $error = utils.debounce(Message.error, 2000, true);//2ç§’å†… åªåˆæ¬¡ç”Ÿæ•ˆ

        const phone = Cookies.get('phone')
        const userName = Cookies.get('userName')
        const loginName = Cookies.get('loginName')
        const Authorization = Cookies.get('Authorization')
        // æŠŠä¸Šé¢ä»cookieé‡Œé¢è·å–åˆ°çš„ä¿¡æ¯åˆå¹¶åˆ°APP_USERè¿™ä¸ªå¯¹è±¡ä¸­
        const APP_USER = {
            phone,
            userName,
            loginName,
            newtoken: Authorization,
        }
        // æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨ request
        axios.interceptors.request.use(request => {
            // åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆ æ¯”å¦‚åœ¨æ¯ä¸ªè¯·æ±‚å‘é€ä¹‹å‰ åœ¨è¯·æ±‚å¤´æ·»åŠ ç™»å½•è®¤è¯ä¿¡æ¯(å› ä¸ºæ¥å£éœ€è¦token)
            request.headers['APP_USER'] = JSON.stringify(APP_USER)
            return request
        })
        // æ·»åŠ å“åº”æ‹¦æˆªå™¨ response
        axios.interceptors.response.use(response => {
            // å¯¹å“åº”æ•°æ®åšç‚¹ä»€ä¹ˆ æ¯”å¦‚
            let { data: resp } = response;
            return new Promise((resolve, reject) => {
                const { errorCode } = resp;
                if (errorCode) {
                    reject(resp);
                    resp.errorMsg && $error(resp.errorMsg);
                } else {
                    resolve(resp)
                }
            })
        }, error => {
            // å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ æ¯”å¦‚æ˜¾ç¤ºå‡ºé”™ä¿¡æ¯ç­‰
            const { response, message } = error
            let errorMsg = ''
            // åˆ†ä¸ºæœ‰å“åº”å’Œæ— å“åº”ä¸¤ç§æƒ…å†µ
            if (!response) {
                errorMsg = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æµ‹ç½‘ç»œæ˜¯å¦æ­£å¸¸ï¼'
            } else {
                const { data } = response
                errorMsg = data && data.errorMsg ? data.errorMsg : 'æœåŠ¡å™¨å‘ç”Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜'
            }
            $error(errorMsg)
            // åœ¨æ§åˆ¶å°æ‰“å°å‡ºé”™çš„æ—¥å¿—ä¿¡æ¯
            console.log(`%c ${ message || errorMsg }`, 'color:#fff,background-color:red');
            return Promise.reject(error)
        })
    </script>
</body>
</html>